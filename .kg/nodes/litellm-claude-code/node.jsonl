{"v": 1, "slug": "litellm-claude-code", "title": "litellm-claude-code", "type": "concept", "created_at": "2026-02-22T05:24:17.709610+00:00"}
{"id": "b-e5907f0a", "type": "decision", "text": "LiteLLM as central auth proxy for all Claude Code agents \u2014 agents set ANTHROPIC_BASE_URL pointing to LiteLLM, ANTHROPIC_CUSTOM_HEADERS for any extra headers. Only LiteLLM holds the real Anthropic API key or OAuth token. [[sprites-dev]]", "created_at": "2026-02-22T05:24:17.709807+00:00", "updated_at": "2026-02-22T05:29:40.217506+00:00"}
{"id": "b-9890565f", "type": "fact", "text": "forward_client_headers_to_llm_api: true in LiteLLM config enables max subscription pass-through \u2014 client sends its OAuth headers, LiteLLM forwards them to Anthropic API so each user's subscription tier is respected", "created_at": "2026-02-22T05:24:21.963579+00:00"}
{"id": "b-0fc4ab50", "type": "note", "text": "(note) OAuth token persistence on LiteLLM for max subscription is TBD \u2014 unclear how to store and refresh tokens across LiteLLM restarts", "created_at": "2026-02-22T05:24:25.735879+00:00", "updated_at": "2026-02-22T05:25:45.854968+00:00"}
{"id": "b-7c421dcc", "type": "note", "text": "proposed [agents.litellm] config section in kg.toml \u2014 would store litellm_url so sprites automatically configure ANTHROPIC_BASE_URL when kg agent run provisions a new sprite [[kg-agent-mux]]", "created_at": "2026-02-22T05:24:30.156601+00:00"}
{"id": "b-bb6bc912", "type": "task", "text": "TBD: local OAuth proxy \u2014 service that extracts valid token from ~/.claude/ on local machine and injects into LiteLLM forwarding headers. Would allow headless sprites to use max subscription without manual token setup. [[kg-agent-mux]]", "status": "pending", "created_at": "2026-02-22T05:29:52.998195+00:00"}
{"id": "b-ca5edf84", "type": "fact", "text": "Claude Code uses LiteLLM as proxy via: ANTHROPIC_BASE_URL=http://litellm:4000, ANTHROPIC_MODEL=anthropic-claude, ANTHROPIC_CUSTOM_HEADERS='x-litellm-api-key: Bearer sk-xxx'. LiteLLM handles real Anthropic auth centrally.", "created_at": "2026-02-22T05:40:07.208391+00:00"}
{"id": "b-84913162", "type": "fact", "text": "LiteLLM config for max subscription: set forward_client_headers_to_llm_api: true in general_settings. This forwards the user's OAuth token to Anthropic, enabling per-user max subscription through a shared gateway.", "created_at": "2026-02-22T05:40:11.090796+00:00"}
{"id": "b-f3da9e44", "type": "decision", "text": "For kg agents on sprites: run LiteLLM on local machine or dedicated sprite. All sprite agents set ANTHROPIC_BASE_URL to LiteLLM's .flycast URL. Only LiteLLM holds the real API key \u2014 no key distribution to individual agents. [[sprites-dev]] [[kg-agent-mux]]", "created_at": "2026-02-22T05:40:15.548800+00:00"}
{"id": "b-301eb848", "type": "task", "text": "TBD: OAuth token persistence \u2014 local proxy extracts token from ~/.claude/ and injects into LiteLLM forwarding headers. Needed for max subscription on headless sprites. Workaround: use API key mode (not max sub).", "status": "pending", "created_at": "2026-02-22T05:40:19.598677+00:00"}
{"id": "b-0fc4ab50", "deleted": true}
{"id": "b-84913162", "deleted": true}
{"id": "b-bb6bc912", "deleted": true}
