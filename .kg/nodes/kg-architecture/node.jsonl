{"v": 1, "slug": "kg-architecture", "title": "kg-architecture", "type": "concept", "created_at": "2026-02-20T08:31:05.434653+00:00"}
{"id": "b-1dab7d6b", "type": "decision", "text": "meta.json replaces meta.jsonl: single JSON file per node, RMW under flock (LOCK_SH read, LOCK_EX write), atomic write via .json.tmp + rename", "created_at": "2026-02-20T08:31:05.434824+00:00"}
{"id": "b-1792b87b", "type": "fact", "text": "meta.json structure: {token_budget, last_reviewed, last_bullet_checkpoint, bullets: {id: {useful, harmful, used}}}", "created_at": "2026-02-20T08:31:09.008026+00:00"}
{"id": "b-3fff8731", "type": "fact", "text": "migrate legacy meta.jsonl on first access: read all lines, merge into meta.json structure, delete legacy file after successful write", "created_at": "2026-02-20T08:31:12.565153+00:00"}
{"id": "b-b14f5123", "type": "decision", "text": "only the inotify watcher writes to SQLite \u2014 CLI commands (kg add, kg review) write JSONL only [kg-stop-hook]", "created_at": "2026-02-20T08:31:16.456699+00:00"}
{"id": "b-1b2e195e", "type": "fact", "text": "kg start creates <project>/.claude -> .kg symlink (ensure_dot_claude_symlink) \u2014 same pattern as mg .claude -> .memory_graph; lets Claude Code find local settings/commands in .kg/", "created_at": "2026-02-20T08:33:42.880182+00:00"}
{"id": "b-96a7b5b3", "type": "fact", "text": "legacy meta.jsonl files auto-deleted after migration to meta.json \u2014 _migrate_legacy_meta() calls legacy.unlink() after writing meta.json", "created_at": "2026-02-20T08:33:48.451631+00:00"}
{"id": "b-262a15b1", "type": "fact", "text": "MCP server uses FastMCP (mcp.run()). Registered with --root <project_root> arg so server finds kg.toml regardless of invocation cwd. Server name 'kg'.", "created_at": "2026-02-20T08:37:16.561158+00:00"}
{"id": "b-1443d426", "type": "fact", "text": "kg start creates <project>/.claude \u2192 .kg symlink (same pattern as mg's .claude \u2192 .memory_graph). Lets Claude Code discover skills/settings in .kg/ when running inside the project dir.", "created_at": "2026-02-20T08:37:17.233509+00:00"}
{"id": "b-30df318f", "type": "fact", "text": "vote_score() Beta prior: (useful + alpha) / (useful + harmful*harmful_weight + alpha + beta). Defaults: alpha=2, beta=2, harmful_weight=2 (neutral=0.5, harmful counts double). Rank multiplier = score*2.0 so neutral\u21921.0x.", "created_at": "2026-02-20T08:37:17.830729+00:00"}
{"id": "b-2246f6c6", "type": "fact", "text": "memory_context MCP tool tracks _seen_slugs process-wide; subsequent calls filter already-seen nodes (differential context). fresh=True resets, existing=[...] seeds from caller. Matches mg pattern.", "created_at": "2026-02-20T08:37:18.467532+00:00"}
{"id": "b-b5403b2d", "type": "gotcha", "text": "cfg.kg_dir property missing from KGConfig \u2014 install.py ensure_dot_claude_symlink uses cfg.kg_dir.resolve() but only index_dir.parent exists as a local var. Fix: add @property kg_dir returning self.index_dir.parent", "created_at": "2026-02-20T08:40:08.977646+00:00"}
{"id": "b-1b2e195e", "deleted": true}
{"id": "b-4b2a7d23", "type": "fact", "text": "kg create <slug> <title> [--type]: creates node with explicit title (defaults to slug in kg add). Idempotent \u2014 exits 0 if already exists. Needed for daily notes nodes like 'Notes 2026-02-20'.", "created_at": "2026-02-20T08:45:23.894884+00:00"}
{"id": "b-2be2585d", "type": "fact", "text": ".claude \u2192 .kg symlink: kg start calls ensure_dot_claude_symlink(cfg) to create <project_root>/.claude \u2192 .kg. Lets Claude Code find skills/settings at .kg/ when working in the project.", "created_at": "2026-02-20T08:45:24.513903+00:00"}
{"id": "b-b4df42db", "type": "gotcha", "text": "cfg.kg_dir property missing from KGConfig: install.py references cfg.kg_dir but it's not defined \u2014 workaround is cfg.index_dir.parent. PENDING: add @property kg_dir to KGConfig.", "created_at": "2026-02-20T08:45:25.120569+00:00"}
